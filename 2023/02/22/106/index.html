

<!DOCTYPE html>
<html lang="" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="JAX-RS接口 XXE及文件上传跟进笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="两个审计记录">
<meta property="og:url" content="http://novysodope.github.io/2023/02/22/106/index.html">
<meta property="og:site_name" content="novy&#39;s Blog">
<meta property="og:description" content="JAX-RS接口 XXE及文件上传跟进笔记">
<meta property="og:locale">
<meta property="og:image" content="http://novysodope.github.io/images/106/Sqg3CnD3F-kL7bZb9UNS8R8fNlFJ4JvM9m1gn5sNUlA.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/gjWnYugem-I-R-5Zi57zEe1ejECrpD0tuuUfa6CD6LY.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/ikT8angWY1sKuqApIh-jWJsMp7lvLYEUTMOLd-3Nwuc.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/YoDnKh6pFhGLAs6hu8MjnHZ6-oPx3dx401zukJrYaRU.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/7DiHftzZCi2BMh1cyhSfy9_MtSbPBQjyF-GK9fyKSqQ.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/EKpLjufyFTxJT0Fub7pXrDAU2g7FWy1z80WWlIQnKV4.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/01kztfM9CSzp1WwmYq8JIX7_dhj7XkaXjTJMzOE9R8k.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/fpnQ_sZaZbYKzO8tPH09uguw6RcF2H2vfHvzHUSP_Y0.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/GRX4uFvMiHLio9LPYJtMnZa2Bn5JEfvVwSC_WxrJZE.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/iEMKAVdJIFLiC0AxsGuFy0ouFeEqvt_aTiIUBaUzRWY.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/oTXbIAZ1nQoFHnCzunHaCz80dqQs-PYWrUZbZhV0_o0.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/AQsgACutCeciokutL3moiS7pr7pyd9HK54oT_3wgoDs.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/UaPFubETXLwPdcc3MB0hiare803b6G-fXj5MT0Fes_0.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/1.png">
<meta property="og:image" content="http://novysodope.github.io/images/106/2.png">
<meta property="article:published_time" content="2023-02-22T05:15:21.000Z">
<meta property="article:modified_time" content="2024-12-11T03:38:02.059Z">
<meta property="article:author" content="novy">
<meta property="article:tag" content="代码审计">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://novysodope.github.io/images/106/Sqg3CnD3F-kL7bZb9UNS8R8fNlFJ4JvM9m1gn5sNUlA.png">
  
  <title>两个审计记录 - novy&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  



<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"novysodope.github.io","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6,h7,h8,h9","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"a6c1581442f57290135c4581f8de49ff","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"ZyJbAKYmfgJXZGNkDKKBRC0i-gzGzoHsz","app_key":"WXTmIgfHD2JkbhooWMtgYW3C","server_url":"https://zyjbakym.lc-cn-n1-shared.com","path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/rss2.xml" title="novy's Blog" type="application/rss+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>novy&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友情链接
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/rss2.xml">
                <i class="iconfont icon-rss-fill"></i>
                RSS
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="两个审计记录">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      novy
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2023-02-22 13:15" pubdate>
        February 22, 2023 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      641 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      2 分钟
    </span>
  

  
  
    

      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">两个审计记录</h1>
            
            <div class="markdown-body">
              <h1 id="JAX-RS接口-XXE跟进记录"><a href="#JAX-RS接口-XXE跟进记录" class="headerlink" title="JAX-RS接口 XXE跟进记录"></a>JAX-RS接口 XXE跟进记录</h1><p>某个项目</p>
<p>在HeikeServiceImpl中有一处解析xml的方法</p>
<p><img src="/images/106/Sqg3CnD3F-kL7bZb9UNS8R8fNlFJ4JvM9m1gn5sNUlA.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>参数input由上一层传来</p>
<p><img src="/images/106/gjWnYugem-I-R-5Zi57zEe1ejECrpD0tuuUfa6CD6LY.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>查看都有哪些地方调用了parseMetadata方法</p>
<p><img src="/images/106/ikT8angWY1sKuqApIh-jWJsMp7lvLYEUTMOLd-3Nwuc.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>先看第二个</p>
<p>在NiganshaServiceImpl类的方法中，是根据传入的appkey来取出需要解析的对象</p>
<p><img src="/images/106/YoDnKh6pFhGLAs6hu8MjnHZ6-oPx3dx401zukJrYaRU.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>除非找到有一个功能可以编辑保存appkey对应的信息，否则这个getXml参数不可控</p>
<p><img src="/images/106/7DiHftzZCi2BMh1cyhSfy9_MtSbPBQjyF-GK9fyKSqQ.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>找需要时间，所以返回上图看WoganshaServiceImpl类</p>
<p>在WoganshaServiceImpl类的方法中，从代码可以看到是传入了一个被base64编码过的参数</p>
<p><img src="/images/106/EKpLjufyFTxJT0Fub7pXrDAU2g7FWy1z80WWlIQnKV4.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>往上跟进addSEDefinition方法，在create方法中用到了addSEDefinition</p>
<p><img src="/images/106/01kztfM9CSzp1WwmYq8JIX7_dhj7XkaXjTJMzOE9R8k.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>再往上跟进就能看到终点</p>
<p><img src="/images/106/fpnQ_sZaZbYKzO8tPH09uguw6RcF2H2vfHvzHUSP_Y0.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>接口中@path注解就是请求路径，参数content就是触发点，参数dtype、appkey随便填，把xxe payload编码成base64后传过去就行了</p>
<p> </p>
<p>最后，第二个点，说到刚刚的NiganshaServiceImpl，找setCurrent</p>
<p>Client.java：</p>
<p><img src="/images/106/GRX4uFvMiHLio9LPYJtMnZa2Bn5JEfvVwSC_WxrJZE.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>将其搜之</p>
<p>可以看到参数xml是被其封装到了Client中</p>
<p><img src="/images/106/iEMKAVdJIFLiC0AxsGuFy0ouFeEqvt_aTiIUBaUzRWY.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>ClientMeta：</p>
<p><img src="/images/106/oTXbIAZ1nQoFHnCzunHaCz80dqQs-PYWrUZbZhV0_o0.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>所以再往回看，实际getCurrent获取到的就是setCurrent的内容</p>
<p><img src="/images/106/AQsgACutCeciokutL3moiS7pr7pyd9HK54oT_3wgoDs.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><img src="/images/106/UaPFubETXLwPdcc3MB0hiare803b6G-fXj5MT0Fes_0.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>然后后面就跟第一个点一样往上找url映射就行了</p>
<h1 id="任意文件上传记录"><a href="#任意文件上传记录" class="headerlink" title="任意文件上传记录"></a>任意文件上传记录</h1><p>UploadController.class</p>
<p><img src="/images/106/1.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>module变量会当成目录传进file对象，filename没有校验格式</p>
<p><img src="/images/106/2.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><code>POST /upload/1/2</code></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">

                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a>
                    
                  </div>
                
              </div>
              <hr>
              <script src="https://utteranc.es/client.js"
        repo="novysodope/novysodope.github.io"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
<hr>
              
                <p class="note note-warning">
                  
                    声明：<br>   本文章用于学习交流，严禁用于非法操作，出现后果一切自行承担，阅读此文章表示你已同意本声明。<br> <br> Disclaimer: <br>   This article is for study and communication. It is strictly forbidden to use it for illegal operations. All consequences shall be borne by yourself. Reading this article means that you have agreed to this statement.
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/04/01/95/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Nevado JMS反序列化审计tips</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/01/18/94/">
                        <span class="hidden-mobile">2020代码审计总结（2022修改版_代码审计快速入门）</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>


            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-x-md">
    <div class="container custom post-custom mx-auto">
      <img src="/img/aa.png" srcset="/img/loading.gif" lazyload class="rounded mx-auto d-block mt-5" style="width:150px; height:150px;"><p></p> <p style="text-align:center"><span>扫一扫关注我们</span></p>
    </div>
  </div>


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     © 2018-<script type="text/javascript">document.write(new Date().getFullYear());</script> <span> <a href="#" target="_blank" rel="nofollow noopener"><font color="#2ca6cb">novy`s Blog</font>.</a> </span> Powered by <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span><font color="#2ca6cb">Hexo</font></span></a><p><script> function secondToDate(second) { if (!second) { return 0; } var time = new Array(0, 0, 0, 0, 0); if (second >= 365 * 24 * 3600) { time[0] = parseInt(second / (365 * 24 * 3600)); second %= 365 * 24 * 3600; } if (second >= 24 * 3600) { time[1] = parseInt(second / (24 * 3600)); second %= 24 * 3600; } if (second >= 3600) { time[2] = parseInt(second / 3600); second %= 3600; } if (second >= 60) { time[3] = parseInt(second / 60); second %= 60; } if (second > 0) { time[4] = second; } return time; }</script> <script type="text/javascript" language="javascript"> function setTime() { var create_time = Math.round(new Date(Date.UTC(2018, 11, 09, 6, 6, 6)).getTime() / 1000); var timestamp = Math.round((new Date().getTime() + 8 * 60 * 60 * 1000) / 1000); currentTime = secondToDate((timestamp - create_time)); currentTimeHtml = currentTime[0] + "年" + currentTime[1] + "天" + currentTime[2] + "时" + currentTime[3] + "分" + currentTime[4] + "秒"; document.getElementById("htmer_time").innerHTML = currentTimeHtml; }    setInterval(setTime, 1000);</script> 本博客已经稳定运行：<span id="htmer_time" style="color: #2ca6cb;"></span> <br/> <script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

你是第<font color="#2ca6cb"><span id="busuanzi_value_site_uv"></span></font>个小伙伴 </p> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?a6c1581442f57290135c4581f8de49ff";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  






<script  src="/js/boot.js" ></script>


</body>
</html>
